<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Smart Adaptive Reading Program (SAP)</title>
<style>
  body {
    font-family: "Comic Sans MS", sans-serif;
    background: #f8fbff;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  header {
    background: #4b8bff;
    color: white;
    padding: 15px;
    font-size: 22px;
    font-weight: bold;
  }
  #main { margin-top: 20px; }
  img {
    width: 200px; height: 200px;
    border-radius: 15px;
    border: 3px solid #ccc;
    object-fit: cover;
    background:#fff;
  }
  .sentence { font-size: 20px; margin: 10px; }
  button {
    font-size: 18px; margin: 10px; padding: 8px 16px;
    border: none; background: #4b8bff; color: white; border-radius: 10px;
    cursor: pointer;
  }
  button:hover { background: #3366cc; }
  #certificate, #hallOfFame {
    display: none; padding: 20px; background: white;
    margin: 20px auto; width: 90%; max-width: 500px;
    border: 10px solid transparent;
    border-image: linear-gradient(45deg, #ff99cc, #99ccff, #ccff99, #ffcc99);
    border-image-slice: 1; border-radius: 20px;
  }
  #certificate h2 { margin: 0; color: #4b8bff; }
  .field { margin: 8px; }
</style>
</head>
<body>

<header>üåà Smart Adaptive Reading Program (SAP)</header>

<div id="main">
  <img id="itemImage" src="" alt="object">
  <div id="textArea" class="sentence"></div>
  <button onclick="playReading()">üîä Play</button>
  <button onclick="nextSentence()">Next Line</button>
  <button onclick="askQuestion()">Ask Question</button>
  <div id="question" class="sentence"></div>
  <button id="nextExerciseBtn" onclick="nextExercise()" style="display:none;">Next Exercise</button>
</div>

<!-- Certificate Section -->
<div id="certificate">
  <h2 id="schoolName">My Lovely School</h2>
  <h3>Certificate of Achievement</h3>
  <p>This certificate is awarded to</p>
  <input class="field" type="text" id="studentName" placeholder="Student Name"><br>
  <input class="field" type="text" id="studentClass" placeholder="Class"><br>
  <input class="field" type="text" id="studentSection" placeholder="Section"><br>
  <p>For successfully completing the Reading Program üéâ</p>
  <button onclick="saveCertificate()">Save & Add to Hall of Fame</button>
</div>

<!-- Hall of Fame -->
<div id="hallOfFame">
  <h3>üèÜ Hall of Fame üèÜ</h3>
  <ul id="fameList"></ul>
</div>

<script>
/* ------------ DATA ------------- */
const exercises = [
  "jet","jelly","key","kite","leaf","lorry",
  "ball","cat","dog","fish","apple","grape",
  "cup","hat","nest","orange","pen","sun",
  "train","zebra"
];

let currentIndex = 0;
let sentenceStage = 0;

/* ------------ DOM ------------- */
const imageElement = document.getElementById("itemImage");
const textArea = document.getElementById("textArea");
const questionArea = document.getElementById("question");
const nextExerciseBtn = document.getElementById("nextExerciseBtn");

/* ------------ IMAGE HELPERS ------------- */
/** Try jpg ‚Üí png ‚Üí webp; if all fail, show a placeholder SVG. */
function setImageForWord(word) {
  const base = `images/${word.toLowerCase()}`;
  const candidates = [`${base}.jpg`, `${base}.png`, `${base}.webp`];
  let i = 0;

  const tryNext = () => {
    if (i >= candidates.length) {
      console.warn("All image candidates failed for:", word);
      imageElement.src = svgPlaceholder(word);
      imageElement.alt = `${word} (placeholder)`;
      return;
    }
    const src = candidates[i++];
    console.log("Trying image:", src);
    imageElement.onerror = tryNext;
    imageElement.onload = () => {
      imageElement.alt = word;
      console.log("Loaded image:", src);
    };
    imageElement.src = src;
  };

  tryNext();
}

/** Simple, crisp placeholder with the word centered */
function svgPlaceholder(word) {
  const text = encodeURIComponent(word);
  const svg = `
    <svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'>
      <rect width='100%' height='100%' fill='#eef3ff'/>
      <rect x='8' y='8' width='184' height='184' rx='16' fill='#ffffff' stroke='#cbd5e1' stroke-width='3'/>
      <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
            font-family='Arial, sans-serif' font-size='22' fill='#334155'>${word}</text>
    </svg>`;
  return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
}

/* ------------ GAME LOGIC ------------- */
function loadExercise() {
  const word = exercises[currentIndex];
  setImageForWord(word);
  sentenceStage = 0;
  questionArea.textContent = "";
  nextExerciseBtn.style.display = "none";
  textArea.textContent = word;
}

function nextSentence() {
  const word = exercises[currentIndex];
  sentenceStage++;
  if (sentenceStage === 1) textArea.textContent = "my " + word;
  else if (sentenceStage === 2) textArea.textContent = "my big " + word;
  else if (sentenceStage === 3) textArea.textContent = "This is my big " + word + ".";
  else nextExerciseBtn.style.display = "inline";
}

function playReading() {
  const utterance = new SpeechSynthesisUtterance(textArea.textContent);
  utterance.rate = 0.7; // slow speed
  utterance.pitch = 1;
  window.speechSynthesis.speak(utterance);
}

function askQuestion() {
  const word = exercises[currentIndex];
  const questions = [
    `What is this?`,
    `Can you say ${word}?`,
    `What color is the ${word}?`,
    `Do you like this ${word}?`
  ];
  questionArea.textContent = questions[Math.floor(Math.random() * questions.length)];
}

function nextExercise() {
  currentIndex++;
  if (currentIndex >= exercises.length) {
    showCertificate();
  } else {
    loadExercise();
  }
}

function showCertificate() {
  document.getElementById("main").style.display = "none";
  document.getElementById("certificate").style.display = "block";
}

function saveCertificate() {
  const name = document.getElementById("studentName").value.trim();
  const cls = document.getElementById("studentClass").value.trim();
  const section = document.getElementById("studentSection").value.trim();

  if (!name) { alert("Please enter your name."); return; }

  const fameList = JSON.parse(localStorage.getItem("fameList") || "[]");
  fameList.push({ name, cls, section });
  localStorage.setItem("fameList", JSON.stringify(fameList));

  showHallOfFame();
}

function showHallOfFame() {
  document.getElementById("certificate").style.display = "none";
  document.getElementById("hallOfFame").style.display = "block";
  const fameList = JSON.parse(localStorage.getItem("fameList") || "[]");
  const fameListElement = document.getElementById("fameList");
  fameListElement.innerHTML = "";
  fameList.forEach(entry => {
    const li = document.createElement("li");
    li.textContent = `${entry.name} ‚Äì Class ${entry.cls} (${entry.section})`;
    fameListElement.appendChild(li);
  });
}

/* Use DOMContentLoaded to start as soon as the DOM is ready */
document.addEventListener("DOMContentLoaded", loadExercise);
</script>
</body>
</html>
