<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gtk Reading Program for Kids ü¶Å</title>
<style>
body {
  font-family: "Comic Sans MS", sans-serif;
  background: linear-gradient(135deg, #e8f0ff, #f9faff);
  text-align: center;
  margin: 0;
  padding: 0;
}
header {
  background: #4b8bff;
  color: white;
  padding: 15px;
  font-size: 22px;
  font-weight: bold;
}
#main { margin-top: 20px; }
.sentence { font-size: 26px; margin: 20px; color: #333; }
button {
  font-size: 18px; margin: 10px; padding: 10px 20px;
  border: none; background: #4b8bff; color: white;
  border-radius: 10px; cursor: pointer;
}
button:hover { background: #3366cc; }
#scoreBoard { font-size: 20px; margin: 20px; color: #333; }
#voiceSelect { font-size: 16px; padding: 5px; border-radius: 6px; }
#imageBox {
  width: 250px; height: 250px; margin: 10px auto;
  border-radius: 20px; box-shadow: 0 0 10px #aaa;
  overflow: hidden; position: relative;
}
#imageBox img { width: 100%; height: 100%; object-fit: cover; }
#editLabel {
  font-size: 14px; margin-top: 5px; color: #4b8bff; cursor: pointer;
  text-decoration: underline;
}
#listenBtn.listening { background: #ff9900; }
#feedback { font-size: 22px; margin-top: 10px; height: 28px; }

/* Talking Lion Animation */
@keyframes lionTalk {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.05) rotate(-1deg); }
  75% { transform: scale(1.05) rotate(1deg); }
}
#pic.reading {
  animation: lionTalk 0.6s infinite ease-in-out;
  filter: brightness(1.05);
}

/* Listening Animation */
@keyframes lionListen {
  0%, 100% { transform: scale(1); filter: brightness(1); }
  50% { transform: scale(1.04); filter: brightness(1.3); }
}
#pic.listening {
  animation: lionListen 0.8s infinite ease-in-out;
  filter: drop-shadow(0 0 10px #ffb84d);
}

/* Hall of Fame */
#hallOfFame {
  margin: 40px auto; max-width: 550px;
  background: #fff; border-radius: 15px; box-shadow: 0 0 8px #aaa;
  padding: 15px;
}
#hallOfFame h2 { color: #4b8bff; margin-bottom: 10px; }
table { width: 100%; border-collapse: collapse; border:1px solid #bbb; }
th, td {
  border: 1px solid #bbb; padding: 8px; font-size: 15px;
}
th { background: #f0f4ff; color: #333; }
tr:nth-child(even) { background: #f9f9f9; }
</style>
</head>
<body>

<header>üìñ Gtk Reading Program for Kids ü¶Å</header>

<!-- Intro -->
<div id="intro">
  <h2>üëã Welcome!</h2>
  <p>Please enter your details to begin:</p>
  <input id="studentName" placeholder="Your Name" style="padding:6px;margin:5px;">
  <input id="studentClass" placeholder="Class" style="padding:6px;margin:5px;">
  <button onclick="startProgram()">Start Reading Test</button>
</div>

<!-- Main Reading Area -->
<div id="main" style="display:none;">
  <div id="imageBox">
    <img id="pic" src="images/reader_lion.png" alt="Reader Lion">
  </div>
  <div id="editLabel" onclick="adminChangeImage()">üñä Insert/Change Picture</div>

  <div id="textArea" class="sentence"></div>
  <div id="feedback"></div>

  <button onclick="playReading()">üîä Listen</button>
  <button id="listenBtn" onclick="startListening()">üé§ Read Aloud</button>
  <button onclick="nextSentence()">‚û°Ô∏è Next</button>

  <div id="scoreBoard">Score: <span id="score">0</span> / 10</div>
  <select id="voiceSelect">
    <option value="en-US">English (US)</option>
    <option value="en-GB">English (UK)</option>
    <option value="en-IN">English (India)</option>
  </select>
</div>

<input type="file" id="fileInput" accept="image/*" style="display:none" />

<!-- Hall of Fame -->
<div id="hallOfFame">
  <h2>üèÜ Hall of Fame</h2>
  <table id="hallTable">
    <thead><tr><th>Name</th><th>Class</th><th>Score</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>
  <button onclick="downloadPDF()">‚¨áÔ∏è Download PDF</button>
  <button onclick="resetHall()">üßπ Reset Hall of Fame</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* ------------ DATA ------------ */
const allExercises = [
  ["apple","green apple","I like to eat a green apple."],
  ["ball","red ball","I can throw a red ball."],
  ["cat","small cat","I have a small cat."],
  ["dog","brown dog","The brown dog is running."],
  ["fish","blue fish","The blue fish swims fast."],
  ["bird","yellow bird","The yellow bird can sing."],
  ["car","blue car","I saw a blue car."],
  ["elephant","big elephant","The big elephant walks slowly."],
  ["lion","wild lion","The wild lion roars loudly."],
  ["zebra","striped zebra","The striped zebra runs fast."]
];
const exercises = allExercises.sort(() => 0.5 - Math.random()).slice(0, 10);

let currentIndex = 0, sentenceStage = 0, score = 0;
let student = { name:"", className:"" };

const textArea = document.getElementById("textArea");
const scoreDisplay = document.getElementById("score");
const voiceSelect = document.getElementById("voiceSelect");
const imageBox = document.getElementById("pic");
const fileInput = document.getElementById("fileInput");
const feedback = document.getElementById("feedback");

/* ------------ START ------------ */
function startProgram(){
  const name = document.getElementById("studentName").value.trim();
  const cls = document.getElementById("studentClass").value.trim();
  if(!name || !cls) return alert("Please enter your name and class.");
  student={name, className:cls};
  document.getElementById("intro").style.display="none";
  document.getElementById("main").style.display="block";
  loadExercise();
}

/* ------------ IMAGE EDIT ------------ */
let imageMap = JSON.parse(localStorage.getItem("gtkImageMap")||"{}");
function adminChangeImage(){ fileInput.click(); }
fileInput.addEventListener("change",()=>{
  const f=fileInput.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=e=>{
    const key=exercises[currentIndex][0].toLowerCase();
    imageMap[key]=e.target.result;
    localStorage.setItem("gtkImageMap",JSON.stringify(imageMap));
    imageBox.src=e.target.result;
    feedback.textContent="‚úÖ Picture updated!";
    setTimeout(()=>feedback.textContent="",1000);
  };
  r.readAsDataURL(f);
});
function loadImage(k){ imageBox.src=imageMap[k.toLowerCase()]||"images/reader_lion.png"; }

/* ------------ SPEAK ------------ */
function playReading(){
  const utter=new SpeechSynthesisUtterance(textArea.textContent);
  utter.rate=0.8; utter.lang=voiceSelect.value;
  const originalSrc=imageBox.src;
  imageBox.src="images/reader_lion.png";
  imageBox.classList.add("reading");
  utter.onend=()=>{ imageBox.classList.remove("reading"); loadImage(exercises[currentIndex][0]); };
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utter);
}

/* ------------ LISTEN ------------ */
let recognition;
if('webkitSpeechRecognition'in window){
  recognition=new webkitSpeechRecognition();
  recognition.lang='en-US'; recognition.continuous=false; recognition.interimResults=false;
  recognition.onstart=()=>{ imageBox.classList.add("listening"); };
  recognition.onend=()=>{ imageBox.classList.remove("listening"); };
  recognition.onresult=e=>{
    const spoken=e.results[0][0].transcript.toLowerCase().trim();
    const expected=textArea.textContent.toLowerCase().replace(/[^\w\s]/g,'');
    if(spoken.includes(expected.split(" ")[0])){
      if(score<10)score++;
      scoreDisplay.textContent=score;
      feedback.textContent="‚úÖ Correct!";
      setTimeout(()=>{feedback.textContent=""; nextSentence();},1000);
    }else{
      feedback.textContent="‚ùå Try again!";
      setTimeout(()=>feedback.textContent="",1200);
    }
  };
}
function startListening(){ if(recognition)recognition.start(); }

/* ------------ FLOW ------------ */
function loadExercise(){
  sentenceStage=0;
  const c=exercises[currentIndex];
  textArea.textContent=c[sentenceStage];
  loadImage(c[0]);
  playReading();
}
function nextSentence(){
  const c=exercises[currentIndex];
  sentenceStage++;
  if(sentenceStage<3){ textArea.textContent=c[sentenceStage]; playReading(); }
  else{
    if(currentIndex<exercises.length-1){ currentIndex++; setTimeout(loadExercise,1000);}
    else endTest();
  }
}

/* ------------ HALL OF FAME ------------ */
function showHallOfFame(){
  const t=document.querySelector("#hallTable tbody");
  t.innerHTML="";
  const d=JSON.parse(localStorage.getItem("gtkHallOfFame")||"[]");
  d.sort((a,b)=>b.score-a.score);
  d.forEach(e=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${e.name}</td><td>${e.className}</td><td>${e.score}</td><td>${e.date}</td>`;
    t.appendChild(tr);
  });
}
function saveToHallOfFame(name,className,score){
  const d=JSON.parse(localStorage.getItem("gtkHallOfFame")||"[]");
  const date=new Date().toLocaleDateString();
  d.push({name,className,score,date});
  localStorage.setItem("gtkHallOfFame",JSON.stringify(d));
  showHallOfFame();
}
function endTest(){
  textArea.textContent=`üéâ Great job ${student.name}! You scored ${score} out of 10!`;
  imageBox.src="images/reader_lion.png";
  document.querySelectorAll("#main button,#voiceSelect").forEach(e=>e.style.display="none");
  saveToHallOfFame(student.name,student.className,score);
}

/* ------------ PDF ------------ */
async function downloadPDF(){
  const {jsPDF}=window.jspdf; const doc=new jsPDF();
  const trophy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAvUlEQVRIS+3UQQrCQBBF0Q8xB2ygC7gg20EkuoL3ZAHf5aXBD+FtLGyNEak8cVv/jfVdt3n7kwKMpUkkvZmIHe84dH7+ClqlqPBPZzhYUzpsYQ1lF1tZJfE3EcROZ7W4tZKpWn+DKC3VbRJEiJNEkDVmCHFCMMUgwxQjDFIMMUowxSDFGMMSgQpn7wCB2yDawYiPM/nIC2beZVZk6tM6B7gZbp7ZUnW1vAAAAAElFTkSuQmCC";
  const pageW=doc.internal.pageSize.getWidth();
  const title="Hall of Fame - Gtk Reading Program";
  const txtW=doc.getTextWidth(title);
  const x=(pageW-txtW)/2;
  doc.addImage(trophy,"PNG",x-15,17,10,10);
  doc.setFont("helvetica","bold"); doc.setFontSize(16);
  doc.text(title,x,25);
  doc.addImage(trophy,"PNG",x+txtW+5,17,10,10);
  doc.setLineWidth(0.5);
  let y=40;
  doc.rect(15,y-8,180,10);
  doc.text("Name",25,y-2);
  doc.text("Class",75,y-2);
  doc.text("Score",125,y-2);
  doc.text("Date",165,y-2);
  const data=JSON.parse(localStorage.getItem("gtkHallOfFame")||"[]");
  data.sort((a,b)=>b.score-a.score);
  data.forEach(e=>{
    y+=10; doc.rect(15,y-8,180,10);
    doc.text(e.name,25,y-2); doc.text(e.className,75,y-2);
    doc.text(e.score.toString(),125,y-2); doc.text(e.date,165,y-2);
  });
  doc.addImage(trophy,"PNG",pageW/2-5,y+15,10,10);
  doc.save("Hall_of_Fame.pdf");
}
function resetHall(){
  if(confirm("‚ö†Ô∏è Clear all Hall of Fame records?")){
    localStorage.removeItem("gtkHallOfFame");
    showHallOfFame(); alert("Hall of Fame cleared.");
  }
}

/* ------------ INIT ------------ */
document.addEventListener("DOMContentLoaded",showHallOfFame);
</script>
</body>
</html>
