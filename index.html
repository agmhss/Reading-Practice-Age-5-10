<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gtk Reading Program for Kids</title>
<style>
  body {
    font-family: "Comic Sans MS", sans-serif;
    background: linear-gradient(135deg, #e8f0ff, #f9faff);
    text-align: center;
    margin: 0; padding: 0;
  }
  header {
    background: #4b8bff; color: white;
    padding: 15px; font-size: 22px; font-weight: bold;
  }
  #main { margin-top: 20px; }
  .sentence { font-size: 26px; margin: 20px; color: #333; }
  button {
    font-size: 18px; margin: 10px; padding: 10px 20px;
    border: none; background: #4b8bff; color: white;
    border-radius: 10px; cursor: pointer;
  }
  button:hover { background: #3366cc; }
  #scoreBoard { font-size: 20px; margin: 20px; color: #333; }
  #voiceSelect { font-size: 16px; padding: 5px; border-radius: 6px; }
  #imageBox {
    width: 250px; height: 250px; margin: 10px auto;
    border-radius: 20px; box-shadow: 0 0 10px #aaa; overflow: hidden;
    position: relative;
  }
  #imageBox img { width: 100%; height: 100%; object-fit: cover; }
  #editBtn {
    position: absolute; top: 5px; right: 5px;
    background: rgba(0,0,0,0.6); color: #fff;
    font-size: 14px; padding: 4px 8px; border-radius: 6px; cursor: pointer;
    display: none;
  }
  #listenBtn.listening { background: #ff9900; }

  /* Hall of Fame */
  #hallOfFame {
    margin: 40px auto; max-width: 550px;
    background: #fff; border-radius: 15px; box-shadow: 0 0 8px #aaa;
    padding: 15px;
  }
  #hallOfFame h2 { color: #4b8bff; margin-bottom: 10px; }
  table { width: 100%; border-collapse: collapse; }
  th, td {
    border-bottom: 1px solid #ddd;
    padding: 8px;
  }
  th { background: #f0f4ff; color: #333; }
  tr:nth-child(even) { background: #f9f9f9; }
  @media (max-width: 600px) {
    .sentence { font-size: 22px; }
    #imageBox { width: 180px; height: 180px; }
  }
</style>
</head>
<body>

<header>üìñ Gtk Reading Program for Kids</header>

<div id="main">
  <div id="imageBox">
    <img id="pic" src="" alt="Word Image">
    <div id="editBtn" onclick="adminChangeImage()">üñäÔ∏è Change</div>
  </div>

  <div id="textArea" class="sentence"></div>

  <button onclick="playReading()">üîä Listen</button>
  <button id="listenBtn" onclick="startListening()">üé§ Read Aloud</button>
  <button onclick="nextSentence()">‚û°Ô∏è Next</button>

  <div id="scoreBoard">Score: <span id="score">0</span> / 10</div>
  <select id="voiceSelect">
    <option value="en-US">English (US)</option>
    <option value="en-GB">English (UK)</option>
    <option value="en-IN">English (India)</option>
  </select>
</div>

<!-- Hidden file input for admin -->
<input type="file" id="fileInput" accept="image/*" style="display:none" />

<!-- Hall of Fame -->
<div id="hallOfFame">
  <h2>üèÜ Hall of Fame</h2>
  <table id="hallTable">
    <thead><tr><th>Name</th><th>Class</th><th>Score</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>
  <button onclick="downloadPDF()">‚¨áÔ∏è Download as PDF</button>
  <button onclick="resetHall()">üßπ Reset Hall of Fame</button>
</div>

<!-- Library for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ------------ WORD SETS (Short Example) ------------ */
const allExercises = [
  ["apple", "green apple", "I like to eat a green apple."],
  ["ball", "red ball", "I can throw a red ball."],
  ["cat", "small cat", "I have a small cat."],
  ["dog", "brown dog", "The brown dog is running."],
  ["fish", "blue fish", "The blue fish swims fast."],
  ["bird", "yellow bird", "The yellow bird can sing."],
  ["car", "blue car", "I saw a blue car."],
  ["elephant", "big elephant", "The big elephant walks slowly."],
  ["lion", "wild lion", "The wild lion roars loudly."],
  ["zebra", "striped zebra", "The striped zebra runs fast."]
];

const exercises = allExercises.sort(() => 0.5 - Math.random()).slice(0, 10);

let currentIndex = 0;
let sentenceStage = 0;
let score = 0;
let adminMode = false;

const textArea = document.getElementById("textArea");
const scoreDisplay = document.getElementById("score");
const voiceSelect = document.getElementById("voiceSelect");
const imageBox = document.getElementById("pic");
const listenBtn = document.getElementById("listenBtn");
const editBtn = document.getElementById("editBtn");
const fileInput = document.getElementById("fileInput");

/* ------------ IMAGE MAP ------------ */
let imageMap = JSON.parse(localStorage.getItem("gtkImageMap") || "{}");

function loadImage(keyword) {
  const key = keyword.toLowerCase();
  if (imageMap[key]) {
    imageBox.src = imageMap[key];
  } else {
    imageBox.src = `images/${key}.jpg`;
  }
}

/* ------------ ADMIN IMAGE CHANGE ------------ */
function adminChangeImage() { fileInput.click(); }
fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      const key = exercises[currentIndex][0].toLowerCase();
      imageMap[key] = e.target.result;
      localStorage.setItem("gtkImageMap", JSON.stringify(imageMap));
      imageBox.src = e.target.result;
      alert(`‚úÖ Image for "${key}" updated!`);
    };
    reader.readAsDataURL(file);
  }
});

/* ------------ ADMIN TOGGLE ------------ */
document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.shiftKey && e.key === "A") {
    adminMode = !adminMode;
    editBtn.style.display = adminMode ? "block" : "none";
    alert(adminMode ? "üßë‚Äçüè´ Admin mode ON" : "üîí Admin mode OFF");
  }
});

/* ------------ SPEECH SYNTHESIS ------------ */
function playReading() {
  const utter = new SpeechSynthesisUtterance(textArea.textContent);
  utter.rate = 0.8; utter.lang = voiceSelect.value;
  window.speechSynthesis.speak(utter);
}

/* ------------ SPEECH RECOGNITION ------------ */
let recognition;
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'en-US';
  recognition.onstart = () => {
    listenBtn.classList.add("listening");
    listenBtn.textContent = "üé§ Listening...";
  };
  recognition.onend = () => {
    listenBtn.classList.remove("listening");
    listenBtn.textContent = "üé§ Read Aloud";
  };
  recognition.onresult = (event) => {
    const spoken = event.results[0][0].transcript.toLowerCase().trim();
    const expected = textArea.textContent.toLowerCase().replace(/[^\w\s]/gi, '');
    if (spoken.includes(expected.split(" ")[0])) {
      score++;
      scoreDisplay.textContent = score;
      alert("‚úÖ Great job!");
      nextSentence();
    } else {
      alert("‚ùå Try again!");
    }
  };
} else alert("Speech Recognition not supported in this browser.");

function startListening() { if (recognition) recognition.start(); }

/* ------------ GAME FLOW ------------ */
function loadExercise() {
  sentenceStage = 0;
  const current = exercises[currentIndex];
  textArea.textContent = current[sentenceStage];
  loadImage(current[0]);
  playReading();
}

function nextSentence() {
  const current = exercises[currentIndex];
  sentenceStage++;
  if (sentenceStage < 3) {
    textArea.textContent = current[sentenceStage];
    playReading();
  } else {
    if (currentIndex < exercises.length - 1) {
      currentIndex++;
      setTimeout(loadExercise, 1500);
    } else {
      endTest();
    }
  }
}

/* ------------ HALL OF FAME ------------ */
function showHallOfFame() {
  const fameTable = document.querySelector("#hallTable tbody");
  fameTable.innerHTML = "";
  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  hallData.sort((a,b) => b.score - a.score);
  hallData.forEach(entry => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${entry.name}</td><td>${entry.className}</td><td>${entry.score}</td><td>${entry.date}</td>`;
    fameTable.appendChild(tr);
  });
}

/* ------------ SAVE ------------ */
function saveToHallOfFame(name, className, score) {
  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  const date = new Date().toLocaleDateString();
  hallData.push({ name, className, score, date });
  localStorage.setItem("gtkHallOfFame", JSON.stringify(hallData));
  showHallOfFame();
}

/* ------------ END TEST ------------ */
function endTest() {
  textArea.textContent = `üéâ Great job! You scored ${score} out of 10!`;
  imageBox.src = "images/congrats.jpg";
  document.querySelectorAll("button, select").forEach(el => el.style.display = "none");

  const form = document.createElement("div");
  form.innerHTML = `
    <h3>Enter your details</h3>
    <input id="playerName" placeholder="Name" style="padding:5px; margin:5px;">
    <input id="playerClass" placeholder="Class" style="padding:5px; margin:5px;">
    <button onclick="submitScore()">üèÜ Submit to Hall of Fame</button>
  `;
  document.body.appendChild(form);
}

function submitScore() {
  const name = document.getElementById("playerName").value.trim();
  const className = document.getElementById("playerClass").value.trim();
  if (!name || !className) return alert("Please enter name and class!");
  saveToHallOfFame(name, className, score);
  document.body.querySelector("div h3").parentElement.remove();
}

/* ------------ PDF DOWNLOAD ------------ */
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Gtk Reading Program - Hall of Fame", 20, 20);
  doc.setFontSize(12);

  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  let y = 40;
  doc.text("Name", 20, y);
  doc.text("Class", 70, y);
  doc.text("Score", 120, y);
  doc.text("Date", 160, y);
  y += 10;

  hallData.sort((a,b) => b.score - a.score).forEach(entry => {
    doc.text(entry.name, 20, y);
    doc.text(entry.className, 70, y);
    doc.text(entry.score.toString(), 120, y);
    doc.text(entry.date, 160, y);
    y += 10;
    if (y > 270) { doc.addPage(); y = 20; }
  });

  doc.save("Hall_of_Fame.pdf");
}

/* ------------ RESET ------------ */
function resetHall() {
  if (confirm("‚ö†Ô∏è Are you sure you want to clear all Hall of Fame records?")) {
    localStorage.removeItem("gtkHallOfFame");
    alert("Hall of Fame cleared.");
    showHallOfFame();
  }
}

/* ------------ INIT ------------ */
document.addEventListener("DOMContentLoaded", () => {
  loadExercise();
  showHallOfFame();
});
</script>
</body>
</html>
