<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gtk Reading Program for Kids</title>
<style>
  body {
    font-family: "Comic Sans MS", sans-serif;
    background: linear-gradient(135deg, #e8f0ff, #f9faff);
    text-align: center; margin: 0; padding: 0;
  }
  header {
    background: #4b8bff; color: white;
    padding: 15px; font-size: 22px; font-weight: bold;
  }
  #main { margin-top: 20px; }
  .sentence { font-size: 26px; margin: 20px; color: #333; }
  button {
    font-size: 18px; margin: 10px; padding: 10px 20px;
    border: none; background: #4b8bff; color: white;
    border-radius: 10px; cursor: pointer;
  }
  button:hover { background: #3366cc; }
  #scoreBoard { font-size: 20px; margin: 20px; color: #333; }
  #voiceSelect { font-size: 16px; padding: 5px; border-radius: 6px; }
  #imageBox {
    width: 250px; height: 250px; margin: 10px auto;
    border-radius: 20px; box-shadow: 0 0 10px #aaa; overflow: hidden;
    position: relative;
  }
  #imageBox img { width: 100%; height: 100%; object-fit: cover; }
  #editLabel {
    font-size: 14px; margin-top: 5px; color: #4b8bff; cursor: pointer;
    text-decoration: underline;
  }
  #listenBtn.listening { background: #ff9900; }
  #feedback { font-size: 22px; margin-top: 10px; height: 28px; }

  /* Hall of Fame */
  #hallOfFame {
    margin: 40px auto; max-width: 550px;
    background: #fff; border-radius: 15px; box-shadow: 0 0 8px #aaa;
    padding: 15px;
  }
  #hallOfFame h2 { color: #4b8bff; margin-bottom: 10px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border-bottom: 1px solid #ddd; padding: 8px; }
  th { background: #f0f4ff; color: #333; }
  tr:nth-child(even) { background: #f9f9f9; }
</style>
</head>
<body>

<header>üìñ Gtk Reading Program for Kids</header>

<!-- Name & class at start -->
<div id="intro">
  <h2>üëã Welcome!</h2>
  <p>Please enter your details to begin:</p>
  <input id="studentName" placeholder="Your Name" style="padding:6px;margin:5px;">
  <input id="studentClass" placeholder="Class" style="padding:6px;margin:5px;">
  <button onclick="startProgram()">Start Reading Test</button>
</div>

<div id="main" style="display:none;">
  <div id="imageBox">
    <img id="pic" src="" alt="Word Image">
  </div>
  <div id="editLabel" onclick="adminChangeImage()">üñä Insert the relevant picture here</div>

  <div id="textArea" class="sentence"></div>
  <div id="feedback"></div>

  <button onclick="playReading()">üîä Listen</button>
  <button id="listenBtn" onclick="startListening()">üé§ Read Aloud</button>
  <button onclick="nextSentence()">‚û°Ô∏è Next</button>

  <div id="scoreBoard">Score: <span id="score">0</span> / 10</div>
  <select id="voiceSelect">
    <option value="en-US">English (US)</option>
    <option value="en-GB">English (UK)</option>
    <option value="en-IN">English (India)</option>
  </select>
</div>

<!-- Hidden file input for admin -->
<input type="file" id="fileInput" accept="image/*" style="display:none" />

<!-- Hall of Fame -->
<div id="hallOfFame">
  <h2>üèÜ Hall of Fame</h2>
  <table id="hallTable">
    <thead><tr><th>Name</th><th>Class</th><th>Score</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>
  <button onclick="downloadPDF()">‚¨áÔ∏è Download PDF</button>
  <button onclick="resetHall()">üßπ Reset Hall of Fame</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ---------------- WORD DATA ---------------- */
const allExercises = [
  ["apple", "green apple", "I like to eat a green apple."],
  ["ball", "red ball", "I can throw a red ball."],
  ["cat", "small cat", "I have a small cat."],
  ["dog", "brown dog", "The brown dog is running."],
  ["fish", "blue fish", "The blue fish swims fast."],
  ["bird", "yellow bird", "The yellow bird can sing."],
  ["car", "blue car", "I saw a blue car."],
  ["elephant", "big elephant", "The big elephant walks slowly."],
  ["lion", "wild lion", "The wild lion roars loudly."],
  ["zebra", "striped zebra", "The striped zebra runs fast."]
];
const exercises = allExercises.sort(() => 0.5 - Math.random()).slice(0, 10);

let currentIndex = 0;
let sentenceStage = 0;
let score = 0;
let student = { name: "", className: "" };

const textArea = document.getElementById("textArea");
const scoreDisplay = document.getElementById("score");
const voiceSelect = document.getElementById("voiceSelect");
const imageBox = document.getElementById("pic");
const listenBtn = document.getElementById("listenBtn");
const fileInput = document.getElementById("fileInput");
const feedback = document.getElementById("feedback");

/* ---------------- START ---------------- */
function startProgram() {
  const name = document.getElementById("studentName").value.trim();
  const cls = document.getElementById("studentClass").value.trim();
  if (!name || !cls) return alert("Please enter your name and class.");
  student = { name, className: cls };
  document.getElementById("intro").style.display = "none";
  document.getElementById("main").style.display = "block";
  loadExercise();
}

/* ---------------- IMAGE MAP ---------------- */
let imageMap = JSON.parse(localStorage.getItem("gtkImageMap") || "{}");
function loadImage(keyword) {
  const key = keyword.toLowerCase();
  imageBox.src = imageMap[key] || `images/${key}.jpg`;
}

/* ---------------- IMAGE CHANGE ---------------- */
function adminChangeImage() { fileInput.click(); }
fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      const key = exercises[currentIndex][0].toLowerCase();
      imageMap[key] = e.target.result;
      localStorage.setItem("gtkImageMap", JSON.stringify(imageMap));
      imageBox.src = e.target.result;
      feedback.textContent = "‚úÖ Picture updated!";
    };
    reader.readAsDataURL(file);
  }
});

/* ---------------- SPEECH SYNTHESIS ---------------- */
function playReading() {
  const utter = new SpeechSynthesisUtterance(textArea.textContent);
  utter.rate = 0.8; utter.lang = voiceSelect.value;
  window.speechSynthesis.speak(utter);
}

/* ---------------- SPEECH RECOGNITION ---------------- */
let recognition;
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'en-US';
  recognition.onresult = (event) => {
    const spoken = event.results[0][0].transcript.toLowerCase().trim();
    const expected = textArea.textContent.toLowerCase().replace(/[^\w\s]/g, '');
    if (spoken.includes(expected.split(" ")[0])) {
      if (score < 10) score++;
      scoreDisplay.textContent = score;
      feedback.textContent = "‚úÖ Correct!";
      setTimeout(() => { feedback.textContent = ""; nextSentence(); }, 1000);
    } else {
      feedback.textContent = "‚ùå Try again!";
      setTimeout(() => { feedback.textContent = ""; }, 1200);
    }
  };
}
function startListening() { if (recognition) recognition.start(); }

/* ---------------- FLOW ---------------- */
function loadExercise() {
  sentenceStage = 0;
  const current = exercises[currentIndex];
  textArea.textContent = current[sentenceStage];
  loadImage(current[0]);
  playReading();
}

function nextSentence() {
  const current = exercises[currentIndex];
  sentenceStage++;
  if (sentenceStage < 3) {
    textArea.textContent = current[sentenceStage];
    playReading();
  } else {
    if (currentIndex < exercises.length - 1) {
      currentIndex++;
      setTimeout(loadExercise, 1500);
    } else endTest();
  }
}

/* ---------------- HALL OF FAME ---------------- */
function showHallOfFame() {
  const fameTable = document.querySelector("#hallTable tbody");
  fameTable.innerHTML = "";
  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  hallData.sort((a,b) => b.score - a.score);
  hallData.forEach(entry => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${entry.name}</td><td>${entry.className}</td><td>${entry.score}</td><td>${entry.date}</td>`;
    fameTable.appendChild(tr);
  });
}

function saveToHallOfFame(name, className, score) {
  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  const date = new Date().toLocaleDateString();
  hallData.push({ name, className, score, date });
  localStorage.setItem("gtkHallOfFame", JSON.stringify(hallData));
  showHallOfFame();
}

/* ---------------- END TEST ---------------- */
function endTest() {
  textArea.textContent = `üéâ Great job! You scored ${score} out of 10!`;
  imageBox.src = "images/congrats.jpg";
  document.querySelectorAll("#main button, #voiceSelect").forEach(el => el.style.display = "none");
  saveToHallOfFame(student.name, student.className, score);
}

/* ---------------- PDF + RESET ---------------- */
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Gtk Reading Program - Hall of Fame", 20, 20);
  doc.setFontSize(12);
  const hallData = JSON.parse(localStorage.getItem("gtkHallOfFame") || "[]");
  let y = 40;
  doc.text("Name", 20, y);
  doc.text("Class", 70, y);
  doc.text("Score", 120, y);
  doc.text("Date", 160, y);
  y += 10;
  hallData.sort((a,b)=>b.score-a.score).forEach(e=>{
    doc.text(e.name,20,y); doc.text(e.className,70,y);
    doc.text(e.score.toString(),120,y); doc.text(e.date,160,y);
    y+=10; if(y>270){doc.addPage();y=20;}
  });
  doc.save("Hall_of_Fame.pdf");
}

function resetHall() {
  if (confirm("‚ö†Ô∏è Clear all Hall of Fame records?")) {
    localStorage.removeItem("gtkHallOfFame");
    showHallOfFame();
    alert("Hall of Fame cleared.");
  }
}

/* ---------------- INIT ---------------- */
document.addEventListener("DOMContentLoaded", showHallOfFame);
</script>
</body>
</html>
